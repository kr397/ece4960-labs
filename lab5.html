<!DOCTYPE html>
<html lang="en">
    <head>
 
        <title>ECE 4960 Lab 5 - Krithik Ranjan</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
        <link rel="stylesheet" type="text/css" href="main.css">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@100;200;300;400;500;600;700;800&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@200;300;400;600;700;800&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

        <link href="https://fonts.googleapis.com/css2?family=Major+Mono+Display&display=swap" rel="stylesheet">

        <link href="prism.css" rel="stylesheet" />

        <!--
        <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
        <link rel="icon" href="favicon.ico" type="image/x-icon">
        -->

    </head>
    <body>
        <!--
        <nav class="navbar navbar-expand-md">
            
            <a class="navbar-brand">ECE 4960</a>
            <button class="navbar-toggler navbar-dark" type="button" data-toggle="collapse" data-target="#main-navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="main-navigation">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">COURSE WEBSITE</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">CODE REPO</a>
                    </li>
                </ul>
            </div>
        </nav>
        -->

        <div class="container-fluid projects">
            <div class="row align-items-center">
                <div class="col-lg-12 col-md-12 col-sm-12">
                    <h2 class="section-title">LAB 5<br>Open-Loop Control</h2>
                    <p class="section-text">Lab 5 is where we finally assembled the complete robot. This involved wiring the motor drivers to the existing Artemis and the sensor circuit to the motor drivers and the motors on the RC stunt car. By the end of this lab, we had a battery-powered robot with open-loop control to execute a series of moves. </p>

                    <h4 class="section-header">Wiring the Motor Drivers</h4>
                    <p class="section-text">The first part of the lab involved connecting the two motor drivers to the Artemis board. Since we need to control the speed of the motors, the appropriate outputs are the PWM pins. The motor driver is an H-Bridge IC that allows PWM control in both directions using two inputs for each channel. Each motor driver has two channels, and in order to increase the current output to the motor, we couple the two channels on two drivers to run two motors (this allows the motors to run fast). The Artemis board consists of several PWM pins, and I used pins 11, 12, for motor A, and 15, 16 for motor B. The motor and Artemis grounds are shorted to create a common ground, but the voltage supply for both are different, which isolates Artemis from power fluctuations in the motors. I started with connecting one motor, testing it, and then moving to the second motor. </p>

                    <figure><img src="images/lab5/circuit.png" width="60%"><figcaption>Figure: Circuit diagram with Artemis and motor drivers.</figcaption></figure>

                    <p class="section-text">Once a motor driver was connected to Artemis, I tested it using a basic PWM code on the Artemis as shown below. The <code class="inline-code">analogWrite()</code> Arduino function takes an input between 0-255 and maps it to a PWM duty cycle (0% to 100%) to run motors on different speeds. For initial testing, we used a power supply for the motor power, and connected the motor driver output to an oscilloscope channel to view the PWM output. The oscilloscope plot for the motor driver outputs in both directions, running at an analog value of 100 are shown below (power supply voltage of 3.7 V). I repeated this process with the second motor driver after this. </p>

                    <pre><code class="language-ino">// Code for outputting PWM from the Artemis to control the motor driver to run in one direction

int motorA_in1 = 11;
int motorA_in2 = 12;

void setup() {
    pinMode(motorA_in1, OUTPUT);
    pinMode(motorA_in2, OUTPUT);
}

void loop() {
    int curr_speed = 100;

    analogWrite(motorA_in1, curr_speed);
    analogWrite(motorA_in2, 0);
}</code></pre><br>

                    <figure>
                        <img src="images/lab5/oscilloscope_forward.jpg" width="40%">
                        <img src="images/lab5/oscilloscope_backward.jpg" width="40%">
                        <figcaption>Figure: Output of the motor driver on the oscilloscope when the motor is run in one direction (left) and the opposite direction (right).</figcaption>
                    </figure>

                    <h4 class="section-header">Assembling the Robot</h4>
                    <p class="section-text">Once the motor driver circuit was complete on the Artemis side, we disassembled the car and placed the circuit inside. The motor driver outputs were coupled and connected to the two motors in the chassis, while the motor power supply and ground are connected to the two battery wires in the car. Given the tight space on the car, it was important to carefully consider the placement of all the components (Artemis, motor drivers, IMU, TOF sensors) and their connecting wires inside the car. I assembled the circuit onto the car and placed all the components as shown below. Given the slightly longer wires, it would be a tight fit if I place the top cover of the car, and it would also stress the wire joints, so I need to be extremely careful. To make the robot battery-powered, we use the 650 mAh battery to power the Artemis, and the 850 mAh battery for the motors. These were both housed in the battery compartment on the other side of the car. Using two batteries also allowed the robot to run for a longer duration.</p>

                    <figure><img src="images/lab5/robot.jpg" width="60%"><figcaption>Figure: Assembled circuit on the robot</figcaption></figure>
                    
                    <p class="section-text">After hooking up everything in the robot, I tested my previous basic code to see if the motor was running and the wheels were rotating. The videos below show both sides of the wheels rotate in both directions while the robot is powered by the two batteries.</p>

                    <figure><iframe width="560" height="315" src="https://www.youtube.com/embed/xDMRsL_rVd4" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></figure>

                    <figure><iframe width="560" height="315" src="https://www.youtube.com/embed/R33z8R4yS70" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></figure>

                    <h4 class="section-header">Demonstration</h4>
                    <p class="section-text">Finally, the robot was completely assembled and could be run on the floor. I ran the robot with a few different PWM values and found the lower limit to be 40, below which the duty cycle wasnâ€™t high enough to move the robot from its position. With a few attempts, I checked if both the motors were calibrated to the same speed so that the robot can move in a straight line. In the case of my robot, both motors running at analog value of 100 resulted in a completely straight line motion as shown below (with the sample code used to perform the test). </p>

                    <pre><code class="language-ino">void loop() {
    int curr_speed = 100;
    // Delayed start to allow time for placing the robot
    delay(5000);

    // Run forward for 2 seconds
    motor_fwd(motorA_in1, motorA_in2, curr_speed);
    motor_fwd(motorB_in1, motorB_in2, curr_speed);

    delay(2000);

    motor_stop(motorA_in1, motorA_in2);
    motor_stop(motorB_in1, motorB_in2);

    // Busy wait 
    while (1);
}

void motor_fwd(int in1, int in2, int spd)
{
    analogWrite(in1, spd);
    analogWrite(in2, 0);
}

void motor_back(int in1, int in2, int spd)
{
    analogWrite(in1, 0);
    analogWrite(in2, spd);
}

void motor_stop(int in1, int in2)
{
    analogWrite(in1, 0);
    analogWrite(in2, 0);
}</code></pre>

                    <figure><iframe width="560" height="315" src="https://www.youtube.com/embed/_Z1bJNBrB6s" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></figure>

                    <p class="section-text">After running the robot in a straight line, I performed open loop control on the robot, running it over a series of forward movements and turns as described in the code and video below.</p>

                    <pre><code class="language-ino">void loop() {
    int curr_speed = 100;
    delay(5000);

    // Move forward
    motor_fwd(motorA_in1, motorA_in2, curr_speed);
    motor_fwd(motorB_in1, motorB_in2, curr_speed);

    delay(1000);

    motor_stop(motorA_in1, motorA_in2);
    motor_stop(motorB_in1, motorB_in2);

    delay(500);
    
    // Turn left
    motor_fwd(motorA_in1, motorA_in2, curr_speed);
    motor_back(motorB_in1, motorB_in2, curr_speed);

    delay(1000);

    // Move forward
    motor_fwd(motorA_in1, motorA_in2, curr_speed);
    motor_fwd(motorB_in1, motorB_in2, curr_speed);

    delay(1000);

    motor_stop(motorA_in1, motorA_in2);
    motor_stop(motorB_in1, motorB_in2);

    delay(500);

    // Turn left 
    motor_fwd(motorA_in1, motorA_in2, curr_speed);
    motor_back(motorB_in1, motorB_in2, curr_speed);

    delay(1000);

    // Move forward
    motor_fwd(motorA_in1, motorA_in2, curr_speed);
    motor_fwd(motorB_in1, motorB_in2, curr_speed);

    delay(1000);

    motor_stop(motorA_in1, motorA_in2);
    motor_stop(motorB_in1, motorB_in2);

    // Busy wait 
    while (1);
}</code></pre>

                <figure><iframe width="560" height="315" src="https://www.youtube.com/embed/3KJ41SoyTX8" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></figure>

                    
                </div>
            </div>
        
        </div>

        <footer class="footer mt-auto py-3">
            <div class="container">
                <h5><a href="index.html">< home</a> | <a href="https://cei-lab.github.io/ECE4960-2022/Lab5.html">handout ></a></h5>
                <p><a href="mailto:kr397@cornell.edu">KR397[AT]CORNELL[DOT]EDU</a></p>
            </div>
        </footer>  
        
        <script src="prism.js"></script>
		<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" integrity="sha384-w1Q4orYjBQndcko6MimVbzY0tgp4pWB4lZ7lr30WKz0vr/aWKhXdBNmNb5D92v7s" crossorigin="anonymous"></script>
    </body>
    
</html>
